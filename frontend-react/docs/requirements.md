# 要求定義（現在の挙動ベース）

本ドキュメントは、Todoist タスクリストアプリケーションの「現在の挙動」をもとにした要求レベルの整理を目的とする。  
将来フルリプレイス時に、実装差分を確認するための俯瞰的な基準とする。

## 1. ビジネス／ユーザー要求

- Todoist を日常的に利用する個人ユーザーが、ラベル（`@goal`, `@task`, `@non-milestone`, `dep-*` 等）を前提に、自分のタスク構造と進捗を一画面で把握できること。
- ゴールタスク（`@goal`）と、それに紐づく作業タスク（`@task`）の関係が自動的に整理され、「どのゴールがまだマイルストーン未設定か」「どこに依存関係があるか」を追加の手作業なく把握できること。
- 直近数か月の「完了件数の推移」と「直近7日間平均」を可視化し、作業量の増減傾向を簡単に確認できること。
- 現在残っている `@task` 数を把握し、今どの程度タスクが残っているかをひと目で確認できること。
- Todoist の標準フィルタ構文を用いてタスク一覧を柔軟に絞り込めること（例: `today`, `p1`, `@label` など）。
- 依存関係を表現する `dep-*` ラベルにより、「どのゴールがどの親ゴールに依存しているか」をタスク名やラベルから追跡できること。
- ログイン後の操作はすべてブラウザ上で完結し、Todoist 側の権限やデータ構造を尊重しつつ追加の管理画面を増やさないこと。

## 2. システム境界に関する要求

- フロントエンド、OAuth プロキシ、Cron 自動化サービスの 3 コンポーネントが協調して動作すること。
  - フロントエンドは Todoist の OAuth アプリケーションを用いてユーザー単位のアクセストークンを取得し、ブラウザのローカルストレージに保存して利用する。
  - OAuth プロキシは、フロントエンドからのコードを Todoist に中継してアクセストークンを取得する役割のみを持ち、Todoist の認証情報をフロントエンドに返す。
  - Cron サービスはシステム全体で共有される `TODOIST_TOKEN` を用いて自動ラベル付与・削除を行い、ユーザーからは直接操作されない。
- フロントエンドは Todoist API の「タスク取得／完了」と「完了済みタスク取得（履歴）」を主な外部依存とし、独自の永続ストレージやバックエンド DB を持たないこと。
- すべての機能は Todoist 上のラベル命名規則（`@goal`, `@task`, `@non-milestone`, `dep-*`, `@毎日のタスク`, 「日付なし」など）に依存することを前提とし、ラベルの意味づけは Todoist 側で管理される。

## 3. ユーザー体験に関する要求

- 主要な情報（ゴールマイルストーン率、日付付きゴール一覧、完了統計グラフ、タスク一覧）が 1 画面に同時表示され、ログイン後にすぐ現在の状況を把握できるレイアウトであること。
- タスク一覧では親子構造を含めたツリー情報を表示し、親タスク名も分かる形でコンテキストを確認できること。
- フィルタ条件や dep 系タスクの非表示設定はブラウザに保存され、再訪問時に前回の設定が復元されること。
- テーマ切り替え（ライト／ダーク）はワンクリックで行え、ユーザーの選択を保存するほか、未設定時には OS のテーマ設定を尊重すること。
- エラー発生時には各パネル単位で分かりやすい文言のエラーメッセージを表示し、アプリ全体が白画面になることを避けること。

## 4. 運用・保守に関する要求

- Cron サービスは 1 時間ごとに自動実行され、`@goal`, `@task`, `@non-milestone`, `dep-*` ラベルに基づく自動処理を継続的に行うこと。
- Cron サービスは Deno Deploy 等のスケジュール実行機能を利用し、Git リポジトリへのデプロイを契機に更新される運用を想定する。
- OAuth プロキシとフロントエンドは、それぞれ独立にデプロイ可能であり、環境変数や設定値で接続先や許可オリジンを切り替えられること。
- ラベル命名規則やタスク構造の前提が変わった場合、フロントエンドと Cron サービスの両方の仕様を見直す必要があることが、ドキュメントから分かるようにしておくこと。

