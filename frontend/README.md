# Todoist タスクリスト

ユーザーの特定の条件に沿ったTodoistのタスクを取得し、そのタスクの親タスクの名前を含めて表示するクライアントアプリケーションです。

## 技術スタック

- パッケージ管理ツール: pnpm
- フレームワーク: Lit
- 認証: OAuth 2.0

## セットアップ

### 1. 依存関係のインストール

```bash
pnpm install
```

### 2. Todoist OAuth アプリケーションの設定

1. [Todoist App Management Console](https://developer.todoist.com/appconsole.html) にアクセス
2. 新しいアプリを作成
3. OAuth redirect URLsに以下を追加:
   - 開発環境: `http://localhost:5173/`
   - 本番環境: あなたのドメイン

### 3. 環境変数の設定

`.env`ファイルを作成し、Todoistから取得したクライアントIDとシークレットを設定:

```bash
VITE_TODOIST_CLIENT_ID=your_actual_client_id
VITE_TODOIST_CLIENT_SECRET=your_actual_client_secret
```

**注意**: クライアントサイドアプリケーションでは、シークレットを完全に隠すことはできません。本番環境では、サーバーサイドでトークン交換を行うことを推奨します。

### 4. プロキシサーバーの起動（必須）

CORSエラーを回避するため、プロキシサーバーが必要です：

```bash
cd proxy
deno run
```

### 5. 開発サーバーの起動

別のターミナルで：

```bash
pnpm dev
```

## 使用方法

### OAuth認証

1. アプリケーションを開く
2. 「Todoistでログイン」ボタンをクリック
3. Todoistの認証画面で許可
4. 自動的にアプリケーションにリダイレクトされ、ログイン完了

### 手動トークン入力（開発用）

OAuth設定が完了していない場合は、「APIトークンで手動ログイン」を選択し、Todoist APIトークンを直接入力できます。

### タスクのフィルタリング

- ログイン後、フィルター機能を使用してタスクを検索
- 親タスクの名前も自動的に表示されます

## 開発

### モック設定

実際のOAuth設定が完了していない場合、開発モードではモック設定が使用されます。この場合、実際の認証は動作しませんが、UIの確認は可能です。

### ビルド

```bash
pnpm build
```

### プレビュー

```bash
pnpm preview
```

## 機能

- OAuth 2.0による安全な認証
- Todoistタスクの取得と表示
- 親タスク名の自動表示
- フィルタリング機能
- ダークモード対応
- レスポンシブデザイン

## セキュリティ

- CSRF攻撃対策（state パラメータ）
- トークンの安全な保存
- 有効期限チェック

## トラブルシューティング

### OAuth認証が失敗する場合

1. **プロキシサーバーが起動しているか確認**
   ```bash
   cd proxy
   deno run dev
   ```

2. **クライアントIDとシークレットが正しく設定されているか確認**
   - `.env`ファイルの内容を確認
   - Todoist App Consoleの設定と一致しているか確認

3. **リダイレクトURLの設定確認**
   - Todoist App Consoleで`http://localhost:5173/`が登録されているか確認
   - スコープが`data:read_write`に設定されているか確認

4. **ブラウザのコンソールでエラーメッセージを確認**

### CORSエラーが発生する場合

1. プロキシサーバー（ポート8001）が正常に起動しているか確認
2. メインアプリケーション（ポート5173）が起動しているか確認
3. 両方のサーバーが同時に動作していることを確認

### 手動トークンでログインできない場合

1. Todoist APIトークンが有効か確認
2. ネットワーク接続を確認
3. ブラウザのローカルストレージをクリア